<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>æ’è¯¾ç³»ç»Ÿç®¡ç†åå°(è°ƒè¯•ç‰ˆ)</title>
  <link rel="stylesheet" href="assets/css/normalize.css">
  <link rel="stylesheet" href="assets/css/main.css?v=2.3">
  <link rel="stylesheet" href="assets/css/admin.css?v=1.2">
  <style>
    /* è°ƒè¯•æ ·å¼ */
    .debug-panel {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      color: #fff;
      padding: 10px;
      border-radius: 5px;
      z-index: 9999;
      max-width: 300px;
      max-height: 200px;
      overflow: auto;
      font-size: 12px;
    }
    
    /* ç¡®ä¿æ‰€æœ‰å…ƒç´ å¯è§ */
    .sidebar {
      display: block !important;
      transform: none !important;
      width: 240px !important;
    }
    
    .content {
      background-color: #f5f7fa !important;
    }
    
    /* å¼ºåˆ¶æ˜¾ç¤ºæ‰€æœ‰å…ƒç´  */
    body * {
      visibility: visible !important;
      opacity: 1 !important;
    }
  </style>
</head>
<body class="admin-panel" style="display: flex; overflow: auto;">
  <div class="debug-panel">
    <div>è°ƒè¯•æ¨¡å¼å·²å¯ç”¨</div>
    <div id="debug-info">åŠ è½½ä¸­...</div>
  </div>

  <aside class="sidebar" style="background-color: #3a0ca3; color: white; height: 100vh;">
    <div class="sidebar-header">
      <h2>æ’è¯¾ç³»ç»Ÿ</h2>
      <button id="toggle-sidebar" class="icon-button">â‰¡</button>
    </div>
    <nav class="sidebar-nav">
      <a href="#dashboard" class="nav-item active">
        <span class="nav-icon">ğŸ“Š</span>
        <span class="nav-text">æ¦‚è§ˆ</span>
      </a>
      <a href="#teachers" class="nav-item">
        <span class="nav-icon">ğŸ‘©â€ğŸ«</span>
        <span class="nav-text">æ•™å¸ˆç®¡ç†</span>
      </a>
      <a href="#courses" class="nav-item">
        <span class="nav-icon">ğŸ“š</span>
        <span class="nav-text">è¯¾ç¨‹ç®¡ç†</span>
      </a>
      <a href="#rooms" class="nav-item">
        <span class="nav-icon">ğŸ¢</span>
        <span class="nav-text">æ•™å®¤ç®¡ç†</span>
      </a>
      <a href="#settings" class="nav-item">
        <span class="nav-icon">âš™ï¸</span>
        <span class="nav-text">ç³»ç»Ÿè®¾ç½®</span>
      </a>
    </nav>
    <div class="sidebar-footer">
      <a href="javascript:void(0);" class="logout-btn" style="display: flex; align-items: center; padding: 10px;">
        <span class="nav-icon">ğŸšª</span>
        <span class="nav-text">é€€å‡ºç™»å½•</span>
      </a>
    </div>
  </aside>

  <main class="content" style="flex: 1; overflow: auto; padding: 20px;">
    <header class="content-header">
      <h1>ä»ªè¡¨ç›˜</h1>
      <div class="user-info">
        <img src="assets/img/admin-avatar.png" alt="ç®¡ç†å‘˜å¤´åƒ" class="avatar">
        <span class="username">ç³»ç»Ÿç®¡ç†å‘˜</span>
      </div>
    </header>

    <div class="dashboard">
      <div class="stat-cards">
        <div class="stat-card">
          <div class="stat-value">12</div>
          <div class="stat-label">æ•™å¸ˆæ€»æ•°</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">156</div>
          <div class="stat-label">æœ¬å‘¨è¯¾ç¨‹æ•°</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">8</div>
          <div class="stat-label">æ•™å®¤æ€»æ•°</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">85%</div>
          <div class="stat-label">æ•™å®¤åˆ©ç”¨ç‡</div>
        </div>
      </div>
    </div>
    
    <div style="margin-top: 20px;">
      <button onclick="showTeachersManagement()" style="padding: 10px; background-color: #4361ee; color: white; border: none; border-radius: 4px; cursor: pointer;">è¿›å…¥æ•™å¸ˆç®¡ç†</button>
      <button onclick="showCoursesManagement()" style="padding: 10px; background-color: #4cc9f0; color: white; border: none; border-radius: 4px; margin-left: 10px; cursor: pointer;">è¿›å…¥è¯¾ç¨‹ç®¡ç†</button>
      <button onclick="window.location.href='setup.html'" style="padding: 10px; background-color: #7209b7; color: white; border: none; border-radius: 4px; margin-left: 10px; cursor: pointer;">ç³»ç»Ÿè¯Šæ–­å·¥å…·</button>
    </div>
  </main>

  <script>
    // è°ƒè¯•ä¿¡æ¯
    function updateDebugInfo() {
      const debugInfo = document.getElementById('debug-info');
      if (!debugInfo) return;
      
      const userInfo = sessionStorage.getItem('currentUser');
      const teachersData = localStorage.getItem('teachers');
      
      let html = '';
      
      if (userInfo) {
        html += `<div>ç”¨æˆ·ä¿¡æ¯: ${userInfo ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}</div>`;
      } else {
        html += `<div style="color: red">æœªæ£€æµ‹åˆ°ç™»å½•ä¿¡æ¯!</div>`;
      }
      
      if (teachersData) {
        try {
          const teachers = JSON.parse(teachersData);
          html += `<div>æ•™å¸ˆæ•°æ®: ${teachers.length}æ¡</div>`;
        } catch (e) {
          html += `<div>æ•™å¸ˆæ•°æ®è§£æé”™è¯¯</div>`;
        }
      } else {
        html += `<div>æœªæ‰¾åˆ°æ•™å¸ˆæ•°æ®</div>`;
      }
      
      debugInfo.innerHTML = html;
    }
    
    // æ•™å¸ˆç®¡ç†
    function showTeachersManagement() {
      window.location.href = '#teachers';
      const content = document.querySelector('.content');
      
      content.innerHTML = `
        <header class="content-header">
          <h1>æ•™å¸ˆç®¡ç†</h1>
          <div class="user-info">
            <img src="assets/img/admin-avatar.png" alt="ç®¡ç†å‘˜å¤´åƒ" class="avatar">
            <span class="username">ç³»ç»Ÿç®¡ç†å‘˜</span>
          </div>
        </header>
        
        <div class="section-content">
          <div class="section-actions">
            <button id="add-teacher" class="btn" style="padding: 10px; background-color: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer;">æ·»åŠ æ•™å¸ˆ</button>
            <div class="search-box" style="margin-left: 10px;">
              <input type="text" id="teacher-search" placeholder="æœç´¢æ•™å¸ˆ...">
            </div>
          </div>

          <div class="data-table-container" style="margin-top: 20px; background: white; border-radius: 8px; padding: 10px;">
            <table class="data-table" style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr>
                  <th style="padding: 10px; border-bottom: 1px solid #ddd; text-align: left;">ID</th>
                  <th style="padding: 10px; border-bottom: 1px solid #ddd; text-align: left;">å§“å</th>
                  <th style="padding: 10px; border-bottom: 1px solid #ddd; text-align: left;">å­¦ç§‘</th>
                  <th style="padding: 10px; border-bottom: 1px solid #ddd; text-align: left;">è”ç³»ç”µè¯</th>
                  <th style="padding: 10px; border-bottom: 1px solid #ddd; text-align: left;">é‚®ç®±</th>
                  <th style="padding: 10px; border-bottom: 1px solid #ddd; text-align: left;">æ“ä½œ</th>
                </tr>
              </thead>
              <tbody id="teachers-table-body">
                <!-- è¿™é‡Œå°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å……æ•™å¸ˆæ•°æ® -->
              </tbody>
            </table>
          </div>
        </div>
      `;
      
      renderTeachersList();
    }
    
    // è¯¾ç¨‹ç®¡ç†
    function showCoursesManagement() {
      window.location.href = '#courses';
      const content = document.querySelector('.content');
      
      content.innerHTML = `
        <header class="content-header">
          <h1>è¯¾ç¨‹ç®¡ç†</h1>
          <div class="user-info">
            <img src="assets/img/admin-avatar.png" alt="ç®¡ç†å‘˜å¤´åƒ" class="avatar">
            <span class="username">ç³»ç»Ÿç®¡ç†å‘˜</span>
          </div>
        </header>
        
        <div class="section-content">
          <div class="section-actions">
            <button id="add-course" class="btn" style="padding: 10px; background-color: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer;">æ·»åŠ è¯¾ç¨‹</button>
            <div class="search-box" style="margin-left: 10px;">
              <input type="text" id="course-search" placeholder="æœç´¢è¯¾ç¨‹...">
            </div>
          </div>

          <div class="data-table-container" style="margin-top: 20px; background: white; border-radius: 8px; padding: 10px;">
            <table class="data-table" style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr>
                  <th style="padding: 10px; border-bottom: 1px solid #ddd; text-align: left;">ID</th>
                  <th style="padding: 10px; border-bottom: 1px solid #ddd; text-align: left;">è¯¾ç¨‹åç§°</th>
                  <th style="padding: 10px; border-bottom: 1px solid #ddd; text-align: left;">æ•™å¸ˆ</th>
                  <th style="padding: 10px; border-bottom: 1px solid #ddd; text-align: left;">æ—¥æœŸ</th>
                  <th style="padding: 10px; border-bottom: 1px solid #ddd; text-align: left;">æ“ä½œ</th>
                </tr>
              </thead>
              <tbody id="courses-table-body">
                <!-- è¿™é‡Œå°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å……è¯¾ç¨‹æ•°æ® -->
              </tbody>
            </table>
          </div>
        </div>
      `;
      
      renderCoursesList();
    }
    
    // æ¸²æŸ“æ•™å¸ˆåˆ—è¡¨
    function renderTeachersList() {
      const tableBody = document.getElementById('teachers-table-body');
      if (!tableBody) return;
      
      tableBody.innerHTML = '';
      
      // å°è¯•è·å–æ•™å¸ˆæ•°æ®
      const teachersData = localStorage.getItem('teachers');
      if (!teachersData) {
        tableBody.innerHTML = '<tr><td colspan="6">æœªæ‰¾åˆ°æ•™å¸ˆæ•°æ®</td></tr>';
        return;
      }
      
      try {
        const teachers = JSON.parse(teachersData);
        
        // éå†æ•™å¸ˆæ•°ç»„å¹¶æ·»åŠ åˆ°è¡¨æ ¼ä¸­
        teachers.forEach(teacher => {
          const row = document.createElement('tr');
          
          row.innerHTML = `
            <td style="padding: 10px; border-bottom: 1px solid #eee;">${teacher.id}</td>
            <td style="padding: 10px; border-bottom: 1px solid #eee;">
              <div style="display: flex; align-items: center;">
                <div style="width: 15px; height: 15px; background-color: ${teacher.color || '#4cc9f0'}; margin-right: 5px; border-radius: 50%;"></div>
                ${teacher.name}
              </div>
            </td>
            <td style="padding: 10px; border-bottom: 1px solid #eee;">${teacher.subject ? teacher.subject.join(', ') : 'æœªè®¾ç½®'}</td>
            <td style="padding: 10px; border-bottom: 1px solid #eee;">${teacher.phone || 'æœªè®¾ç½®'}</td>
            <td style="padding: 10px; border-bottom: 1px solid #eee;">${teacher.email || 'æœªè®¾ç½®'}</td>
            <td style="padding: 10px; border-bottom: 1px solid #eee;">
              <div>
                <button style="background-color: #2196f3; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer;">ç¼–è¾‘</button>
                <button style="background-color: #f44336; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer; margin-left: 5px;">åˆ é™¤</button>
              </div>
            </td>
          `;
          
          tableBody.appendChild(row);
        });
      } catch (error) {
        tableBody.innerHTML = `<tr><td colspan="6">è§£ææ•™å¸ˆæ•°æ®å¤±è´¥: ${error.message}</td></tr>`;
      }
    }
    
    // æ¸²æŸ“è¯¾ç¨‹åˆ—è¡¨
    function renderCoursesList() {
      const tableBody = document.getElementById('courses-table-body');
      if (!tableBody) return;
      
      tableBody.innerHTML = '';
      
      // å°è¯•è·å–è¯¾ç¨‹æ•°æ®
      const schedulesData = localStorage.getItem('schedules');
      if (!schedulesData) {
        tableBody.innerHTML = '<tr><td colspan="5">æœªæ‰¾åˆ°è¯¾ç¨‹æ•°æ®</td></tr>';
        return;
      }
      
      try {
        const schedules = JSON.parse(schedulesData);
        const teachersData = localStorage.getItem('teachers');
        let teachers = [];
        
        if (teachersData) {
          teachers = JSON.parse(teachersData);
        }
        
        // éå†è¯¾ç¨‹æ•°ç»„å¹¶æ·»åŠ åˆ°è¡¨æ ¼ä¸­
        schedules.forEach(course => {
          const row = document.createElement('tr');
          
          // æ‰¾åˆ°æ•™å¸ˆåç§°
          let teacherName = course.teacherName || 'æœªçŸ¥æ•™å¸ˆ';
          const teacher = teachers.find(t => t.id === course.teacherId);
          if (teacher) {
            teacherName = teacher.name;
          }
          
          row.innerHTML = `
            <td style="padding: 10px; border-bottom: 1px solid #eee;">${course.id}</td>
            <td style="padding: 10px; border-bottom: 1px solid #eee;">
              <div style="display: flex; align-items: center;">
                <div style="width: 15px; height: 15px; background-color: ${course.color || '#4cc9f0'}; margin-right: 5px; border-radius: 50%;"></div>
                ${course.subject}
              </div>
            </td>
            <td style="padding: 10px; border-bottom: 1px solid #eee;">${teacherName}</td>
            <td style="padding: 10px; border-bottom: 1px solid #eee;">${course.date} ${course.startTime}-${course.endTime}</td>
            <td style="padding: 10px; border-bottom: 1px solid #eee;">
              <div>
                <button style="background-color: #2196f3; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer;">ç¼–è¾‘</button>
                <button style="background-color: #f44336; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer; margin-left: 5px;">åˆ é™¤</button>
              </div>
            </td>
          `;
          
          tableBody.appendChild(row);
        });
      } catch (error) {
        tableBody.innerHTML = `<tr><td colspan="5">è§£æè¯¾ç¨‹æ•°æ®å¤±è´¥: ${error.message}</td></tr>`;
      }
    }
    
    // é¡µé¢åŠ è½½åæ£€æŸ¥ç”¨æˆ·çŠ¶æ€
    document.addEventListener('DOMContentLoaded', function() {
      // æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯
      const userJson = sessionStorage.getItem('currentUser');
      if (!userJson) {
        alert('æ‚¨å°šæœªç™»å½•ï¼Œå³å°†è·³è½¬åˆ°ç™»å½•é¡µé¢');
        window.location.href = 'login.html';
        return;
      }

      try {
        const user = JSON.parse(userJson);
        if (user.role !== 'admin') {
          alert('æ‚¨æ²¡æœ‰ç®¡ç†å‘˜æƒé™ï¼Œæ— æ³•è®¿é—®æ­¤é¡µé¢');
          window.location.href = 'index.html';
          return;
        }
        
        // æ›´æ–°ç”¨æˆ·åæ˜¾ç¤º
        const usernameElement = document.querySelector('.username');
        if (usernameElement) {
          usernameElement.textContent = user.name;
        }
        
        // æ³¨å†Œé€€å‡ºç™»å½•äº‹ä»¶
        const logoutBtn = document.querySelector('.logout-btn');
        if (logoutBtn) {
          logoutBtn.addEventListener('click', function() {
            sessionStorage.removeItem('currentUser');
            window.location.href = 'login.html';
          });
        }
        
        // æ£€æŸ¥URL hashï¼Œå†³å®šæ˜¾ç¤ºå“ªä¸ªé¡µé¢
        const hash = window.location.hash;
        if (hash === '#teachers') {
          showTeachersManagement();
        } else if (hash === '#courses') {
          showCoursesManagement();
        }
        
        // æ·»åŠ hashå˜åŒ–ç›‘å¬
        window.addEventListener('hashchange', function() {
          const hash = window.location.hash;
          if (hash === '#teachers') {
            showTeachersManagement();
          } else if (hash === '#courses') {
            showCoursesManagement();
          } else if (hash === '#dashboard') {
            window.location.reload();
          }
        });
        
        // æ›´æ–°è°ƒè¯•ä¿¡æ¯
        updateDebugInfo();
      } catch (error) {
        console.error('è§£æç”¨æˆ·æ•°æ®å¤±è´¥:', error);
        alert('ä¼šè¯ä¿¡æ¯æ— æ•ˆï¼Œè¯·é‡æ–°ç™»å½•');
        window.location.href = 'login.html';
      }
    });
  </script>
</body>
</html> 